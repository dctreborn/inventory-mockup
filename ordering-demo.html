<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Ordering Demo</title>

	<script
  src="https://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.min.js"></script>

  <script defer src="https://use.fontawesome.com/releases/v5.0.9/js/all.js" integrity="sha384-8iPTk2s/jMVj81dnzb/iFR2sdA7u06vHJyyLlAd4snFpCl/SnyUjRrbdJsw1pGIl" crossorigin="anonymous"></script>
	
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
</head>
<body>	
	<div class="container">
		<!-- navbar -->
		<nav class="row navbar navbar-expand-lg navbar-light bg-light">
		  <a class="navbar-brand" href="index.html">Navbar</a>
		  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
		    <span class="navbar-toggler-icon"></span>
		  </button>
		  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
		    <div class="navbar-nav">
		      <a class="nav-item nav-link" href="user.html">User</a>
		      <a class="nav-item nav-link" href="admin.html">Admin</a>
		    </div>
		  </div>
		  <form class="form-inline">
		    <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
		    <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
		  </form>
		</nav>
		<br>
		<div class="alert alert-dark row" role="alert">
		  <p>Ordering Demo</p>
		  
		  <p>This page is meant to demonstrate the functionality of calculations using the information in the tables and cards below.
			
			Please keep in mind that no data is saved. Upon leaving or refreshing the page, all data will revert back to their original state.</p>
		</div>
		<br>

		<!-- ordering table -->
		<!-- make columns fixed width
		Item - word wrap
		Vendor - word wrap
		Cat - 20 chars
		Item Description - header width
		previous stock - header width
		current stock - 4 digits/header width
		To order - header width -->
		<div class="row">	
			<table class="table inventory-table">
							<thead>
								<tr>
									<th scope="col">Item</th>
									<th scope="col">Vendor</th>
									<th scope="col">Cat#</th>
									<th scope="col">Item Description</th>
									<th scope="col">Previous Stock</th>
									<th scope="col">Current Stock</th>
									<th scope="col">To Order</th>
									<th scope="col">Last Update</th>
								</tr>
							</thead>
							<tbody>
								<tr class="item1">
									<td>TAQMAN Environmental MMX</td>
									<td>ABI</td>
									<td>0123456789</td>
									<td id="item-desc-table1">10</td>
									<td id="previous-stock1" stock-data="20">20</td>
									<td>
										<div class="input-group input-group-sm mb-3">
											<input type="number" min="0" class="form-control" id="current-stock1" placeholder="number goes here">
										</div>
									</td>
									<td id="result1">0</td>
									<td id="last-update1"></td>						
								</tr>

								<tr class="item2">
									<td>TAQMAN ProAMP MMX</td>
									<td>ABI</td>
									<td>0123456789</td>
									<td id="item-desc-table2">1</td>
									<td id="previous-stock2" stock-data="0.5">0.5</td>
									<td>
										<div class="input-group input-group-sm mb-3">
										  <input type="number" min="0" class="form-control"  id="current-stock2" placeholder="number goes here">
										</div>
									</td>
									<td id="result2">0</td>
									<td id="last-update2"></td>										
								</tr>

								<tr class="item3">
									<td>10uL Tips</td>
									<td>Thermo Fisher</td>
									<td>0123456789</td>
									<td id="item-desc-table3">1</td>
									<td id="previous-stock3" stock-data="10">10</td>
									<td>
										<div class="input-group input-group-sm mb-3">
										  <input type="number" min="0" class="form-control"  id="current-stock3" placeholder="number goes here">
										</div>
									</td>
									<td id="result3">0</td>
									<td id="last-update3"></td>											
								</tr>
							</tbody>
						</table>
		</div>
		
		<!-- updatable data -->

		<div class="row data">
			<!-- BV -->
			<div class="col-sm-12">	
				<div class="card">
				  <div class="card-header">
				    TAQMAN Environmental MMX (general example)
				  </div>
				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Assay</span></div>
				  	<div class="col-sm-3 text-right dashed-border">BVPCR</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">On Hand</span></div>
				  	<div class="col-sm-3 dashed-border text-right" id="on-hand1">10</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Catalog #</span></div>
				  	<div class="col-sm-3 text-right dashed-border">0123456789</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Safety Stock</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="safety-stock1">0.93</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Item Description</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="unit-order1">
				  		<input type="text" maxlength="20" class="form-control reagent-data" id="item-desc1" value="4">
				  		<i class="far fa-edit left"></i>
				  	</div>				  	
				  	<div class="col-sm-3"><span class="badge badge-dark">Weeks of Safety Stock</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
				  		<input type="number" min="0" class="form-control reagent-data" id="safety-weeks1" value="2">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Reactions per Item</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="reactions-per-item1" value="640">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Reorder Point</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="reorder-point1">12</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Weekly Sample Volume</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="weekly-volume1" value="800">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Lead Time (days)</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="lead-time1" value="7">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Runs per Week</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="weekly-runs1" value="20">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Reorder Quantity</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="reorder-quant1">43.5</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Controls per Run</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="run-controls1" value="18">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Weeks of Reorder</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
				  		<input type="number" min="0" class="form-control reagent-data" id="reorder-weeks1" value="24">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>
				</div>
			</div>
		</div>
		<br>	
		<div class="row data">
			<!-- HFE -->
			<div class="col-sm-12">	
				<div class="card">
				  <div class="card-header">
				    TAQMAN ProAMP MMX, 50 mL (fractional example)
				  </div>
				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Assay</span></div>
				  	<div class="col-sm-3 text-right dashed-border">HFE</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">On Hand</span></div>
				  	<div class="col-sm-3 dashed-border text-right" id="on-hand1">1</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Catalog #</span></div>
				  	<div class="col-sm-3 text-right dashed-border">0123456789</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Safety Stock</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="safety-stock1">0.31</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Item Description</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="unit-order1">
				  		<input type="text" maxlength="20" class="form-control reagent-data" id="item-desc1" value="1 vial">
				  		<i class="far fa-edit left"></i>
				  	</div>				  	
				  	<div class="col-sm-3"><span class="badge badge-dark">Weeks of Safety Stock</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
				  		<input type="number" min="0" class="form-control reagent-data" id="safety-weeks1" value="2">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Reactions per Item</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="reactions-per-item1" value="1666">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Reorder Point</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="reorder-point1">12</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Weekly Sample Volume</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="weekly-volume1" value="96">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Lead Time (days)</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="lead-time1" value="5">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Runs per Week</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="weekly-runs1" value="3">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Reorder Quantity</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="reorder-quant1">2</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Controls per Run</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="run-controls1" value="12">
							<i class="far fa-edit left"></i>
				  	</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">Weeks of Reorder</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
				  		<input type="number" min="0" class="form-control reagent-data" id="reorder-weeks1" value="8">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>
				</div>
			</div>	
		</div>
		<br>	
		<div class="row data">
			<!-- Tips -->
			<div class="col-sm-12">	
				<div class="card">
				  <div class="card-header">
				    10 uL Tips (non-volume dependent example)
				  </div>
				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Assay</span></div>
				  	<div class="col-sm-3 text-right dashed-border">General</div>
				  	<div class="col-sm-3"><span class="badge badge-dark">On Hand</span></div>
				  	<div class="col-sm-3 dashed-border text-right"  id="on-hand3">2</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Catalog #</span></div>
				  	<div class="col-sm-3 text-right dashed-border">0123456789</div>
						<div class="col-sm-3"><span class="badge badge-dark">Reorder Point</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="reorder-point3" value="0">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				  <div class="row">
				  	<div class="col-sm-3"><span class="badge badge-dark">Item Description</span></div>
				  	<div class="col-sm-3 text-right dashed-border" id="unit-order3">10</div>
						<div class="col-sm-3"><span class="badge badge-dark">Reorder Quantity</span></div>
				  	<div class="col-sm-3 text-right dashed-border">
							<input type="number" min="0" class="form-control reagent-data" id="reorder-quant3" value="0">
							<i class="far fa-edit left"></i>
				  	</div>
				  </div>

				</div>
			</div>	
		</div>
	</div>

	<script>

		$(":input[type='number']").keydown(event => {
			var invalidChars = ["-","+","e"]

			if(invalidChars.includes(event.key)) {
				event.preventDefault()
			}
		})

		function calculateInventory(num, id, target){
			let baseStock, leadTimeUsage, safetyStock,
				currentStock, 
				weeklyVolume = parseInt($(`#weekly-volume${num}`).val()),
				runsPerWeek = parseInt($(`#weekly-runs${num}`).val()),
				controlsPerRun = parseInt($(`#run-controls${num}`).val()),
				leadTime = parseInt($(`#lead-time${num}`).val()) / 7,
				safetyStockWeeks = parseInt($(`#safety-weeks${num}`).val()),
				reorderWeeks = parseInt($(`#reorder-weeks${num}`).val()),
				reactionsPerOrder = parseInt($(`#reactions-per-item${num}`).val()),
				weeklyUse,
				reorderPoint,
				reorderQuantity,
				previous = $(`#previous-stock${num}`)

			if (id == "current-stock"){
				currentStock = parseFloat($(target)[0].value)
			} else {
				currentStock = parseFloat($(`#current-stock${num}`).val()) || 0
			}

			currentStock = currentStock == "" ? 0 : parseFloat(currentStock)
			$(`#on-hand${num}`).html(currentStock)
			$(`#current-stock${num}`).val(currentStock)

			previous.html(previous.attr("stock-data"))
			previous.attr("stock-data", currentStock)

			if (id == "item-desc") {
				$(`#item-desc-table${num}`).html($(target)[0].value)
			}			

			if (isNaN(weeklyVolume)){
				reorderPoint = parseFloat($(`#reorder-point${num}`).val())

				reorderQuantity = parseFloat($(`#reorder-quant${num}`).val())
			} else {				
				
				reactionsPerOrder = reactionsPerOrder == 0 ? 1 : reactionsPerOrder

				weeklyUse = (weeklyVolume + runsPerWeek * controlsPerRun) / reactionsPerOrder
				// console.log(`weeklyUse ${weeklyUse}`)
				baseStock = weeklyUse * 4
				// console.log(`baseStock ${baseStock}`)
				safetyStock = weeklyUse * safetyStockWeeks
				// console.log(`safetyStock ${safetyStock}`)
				leadTimeUsage = weeklyUse * leadTime
				// console.log(`leadTimeUsage ${leadTimeUsage}`)
				reorderPoint = leadTimeUsage + safetyStock + baseStock
				// console.log(`reorderPoint ${reorderPoint}`)
				reorderQuantity = weeklyUse * reorderWeeks
				// console.log(`reorderQuantity ${reorderQuantity}`)

				$(`#safety-stock${num}`).val(Math.ceil(safetyStock))
				$(`#reorder-point${num}`).val(Math.ceil(reorderPoint * 100)/100)
				$(`#reorder-quant${num}`).val(Math.ceil(reorderQuantity))

			}

			if(currentStock <= reorderPoint){
				$(`#result${num}`).html(Math.ceil(reorderQuantity))
			} else {
				$(`#result${num}`).html(0)
			}
		}

		$(".inventory-table, .data").change(x=>{
			// source of change
			let target = x.target
			let targetId = target.id
			let num = targetId.charAt(targetId.length - 1)
			let id = targetId.substring(0, targetId.length - 1)
			let now = moment()

			calculateInventory(num, id, target)

			$(`#last-update${num}`).html(now.format("MMM DD, YYYY, HH:mm:ss"))
			$(`#last-update${num}`).attr("time", now)

		})

	</script>

	<style>	
		.dashed-border:after {
			content: "";
			display: block;
			width: 105%;
			float: right;
			border-bottom: 1px dashed gray;
		}

		.row {
			padding: 10px;
		}

		.badge {
			width: 100%;
		}

		.reagent-data {
			border: none;
/*			border-style: dashed;
			border-color: gray;*/
			width: 90%;
			padding: 0;
			padding-right: .375rem;
			text-align: right;
			float: right;
		}

		.left {
			float: left;
		}

		.right {
			float: right;
		}

		select {
			border:none;
			padding: 0;
			padding-right: .375rem;
			text-align: right;
			float: right;
		}

		input[type=number]::-webkit-inner-spin-button, 
		input[type=number]::-webkit-outer-spin-button { 
		  -webkit-appearance: none; 
		  margin: 0; 
		}
	</style>
</body>
</html>